let b,h={gettenSchedule:!1};const p={baseUrl:"https://tms.tabadul.sa/api/appointment/tas/v2/",fleetBaseUrl:"https://tms.tabadul.sa/api/fleet/v2/"};chrome.runtime.onMessage.addListener((n,o,a)=>{var r;switch(b=((r=document.cookie.split("; ").find(c=>c.startsWith("fsession=")))==null?void 0:r.split("=")[1])||"",n.action){case"start":{E(n.data),a({status:"success",message:"start",data:{message:""}});break}}return!0});function E(n){const o=new MutationObserver(a=>{a.forEach(r=>{if(!h.gettenSchedule&&r.type==="childList"&&r.addedNodes.length>0){const c=r.addedNodes[0];if(c.nodeType===Node.ELEMENT_NODE){const e=c;if(e.classList.contains("bootstrap-datetimepicker-widget")){const t=e.querySelector(".datepicker-days");if(t){const l=t.querySelector("td:not(.disabled)");l&&(l.click(),l.dispatchEvent(new Event("click")),o.disconnect(),h.gettenSchedule=!0,setTimeout(()=>{const s=document.querySelectorAll("table > tbody > tr input[type=radio]").length>3?document.querySelector("table > tbody > tr:has(input[type=radio]):nth-last-child(3) input[type=radio]"):document.querySelector("table > tbody > tr:has(input[type=radio]):last-child input[type=radio]");if(console.log("input",s),!s)return;s.checked=!0,s.dispatchEvent(new Event("change")),s.dispatchEvent(new Event("click"));const d=document.querySelector("button[data-i18n=nextButtonText]");d&&(d.click(),g(n))},200))}}}}})});o.observe(document.getElementById("finalSchedule"),{childList:!0})}const m=async(n,o={},a=p.baseUrl)=>{const r={"Accept-Language":"ar",Accept:"application/json",token:decodeURIComponent(b)};return await(await fetch(`${a+n}`,{method:"GET",...o,headers:{...r,...o==null?void 0:o.headers}})).json()},y=()=>new Date(Date.now()+864e5).toLocaleDateString("en-CA").replace(/-/g,"/"),g=async n=>{var s,d;const o=new URLSearchParams({finalDestination:"95",finalDestinationTime:y(),q:n.truckNumber}),a=await m(`truck/verified/all/forAdd?${o.toString()}`,void 0,p.fleetBaseUrl),r=new URLSearchParams({finalDestination:"95",finalDestinationTime:y(),q:n.name}),c=await m(`driver/verified/all/forAdd?${r.toString()}`,void 0,p.fleetBaseUrl);if(!((s=a==null?void 0:a.content)!=null&&s[0]))throw new Error("يوجد خطأ فى معلومات الشاحنة");if(!((d=c==null?void 0:c.content)!=null&&d[0]))throw new Error("يوجد خطأ فى معلومات السائق");const e=a.content.filter(i=>i.plateNumberAr.trim()===n.truckNumber.trim()),t=c.content.filter(i=>i.nameAr.trim().startsWith(n.name.trim())),l=document.getElementById("entry");if(l){l.setAttribute("records",JSON.stringify([{truck:{plate_number:e==null?void 0:e[0].plateNumberAr,plateCountry:e==null?void 0:e[0].plateCountry,vehicleSequenceNumber:e==null?void 0:e[0].vehicleSequenceNumber,consignmentNumber:"",truckCategoryGroup:e==null?void 0:e[0].truckCategoryGroup,categoryGroupCode:e==null?void 0:e[0].categoryGroupCode,truckColorCode:e==null?void 0:e[0].truckColorCode,plateType:e==null?void 0:e[0].plateType,chassisNo:e==null?void 0:e[0].chassisNo},driver:{DRIVER_NAME:t==null?void 0:t[0].nameAr,LICENSE_NUMBER:t==null?void 0:t[0].licenseNo,residentCountry:t==null?void 0:t[0].residentCountry}}]));const i=document.querySelector(".pledge-check input");if(!i)return;i.checked=!0,i.dispatchEvent(new Event("change")),i.dispatchEvent(new Event("click"));const u=document.querySelector("div.wizard-action-buttons button[data-i18n=submitButtonText]");u&&(u.click(),u.dispatchEvent(new Event("click")))}};
