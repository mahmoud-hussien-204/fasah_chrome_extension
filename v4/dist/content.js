let y,u={gettenSchedule:!1};const p={baseUrl:"https://tms.tabadul.sa/api/appointment/tas/v2/",fleetBaseUrl:"https://tms.tabadul.sa/api/fleet/v2/"};chrome.runtime.onMessage.addListener((o,a,r)=>{var n;switch(y=((n=document.cookie.split("; ").find(c=>c.startsWith("fsession=")))==null?void 0:n.split("=")[1])||"",o.action){case"start":{b(o.data),r({status:"success",message:"start",data:{message:""}});break}}return!0});function b(o){const a=new MutationObserver(r=>{r.forEach(n=>{if(console.log("mutation",n),!u.gettenSchedule&&n.type==="childList"&&n.addedNodes.length>0){const c=n.addedNodes[0];if(c.nodeType===Node.ELEMENT_NODE){const e=c;if(e.classList.contains("bootstrap-datetimepicker-widget")){const t=e.querySelector(".datepicker-days");if(t){const l=t.querySelector("td:not(.disabled)");l&&(l.click(),l.dispatchEvent(new Event("click")),a.disconnect(),u.gettenSchedule=!0,setTimeout(()=>{const s=document.querySelectorAll("table > tbody > tr input[type=radio]").length>3?document.querySelector("table > tbody > tr:has(input[type=radio]):nth-last-child(3) input[type=radio]"):document.querySelector("table > tbody > tr:has(input[type=radio]):last-child input[type=radio]");if(console.log("input",s),!s)return;s.checked=!0,s.dispatchEvent(new Event("change")),s.dispatchEvent(new Event("click"));const i=document.querySelector("button[data-i18n=nextButtonText]");i&&(i.click(),g(o))},200))}}}}})});a.observe(document.getElementById("finalSchedule"),{childList:!0})}const m=async(o,a={},r=p.baseUrl)=>{const n={"Accept-Language":"ar",Accept:"application/json",token:decodeURIComponent(y)};return await(await fetch(`${r+o}`,{method:"GET",...a,headers:{...n,...a==null?void 0:a.headers}})).json()},h=()=>new Date(Date.now()+864e5).toLocaleDateString("en-CA").replace(/-/g,"/"),g=async o=>{var s,i;const a=new URLSearchParams({finalDestination:"95",finalDestinationTime:h(),q:o.truckNumber}),r=await m(`truck/verified/all/forAdd?${a.toString()}`,void 0,p.fleetBaseUrl),n=new URLSearchParams({finalDestination:"95",finalDestinationTime:h(),q:o.name}),c=await m(`driver/verified/all/forAdd?${n.toString()}`,void 0,p.fleetBaseUrl);if(!((s=r==null?void 0:r.content)!=null&&s[0]))throw new Error("يوجد خطأ فى معلومات الشاحنة");if(!((i=c==null?void 0:c.content)!=null&&i[0]))throw new Error("يوجد خطأ فى معلومات السائق");const e=r.content.filter(d=>d.plateNumberAr.trim()===o.truckNumber.trim()),t=c.content.filter(d=>d.nameAr.trim().startsWith(o.name.trim())),l=document.getElementById("entry");l&&(l.setAttribute("records",JSON.stringify([{truck:{plate_number:e==null?void 0:e[0].plateNumberAr,plateCountry:e==null?void 0:e[0].plateCountry,vehicleSequenceNumber:e==null?void 0:e[0].vehicleSequenceNumber,consignmentNumber:"",truckCategoryGroup:e==null?void 0:e[0].truckCategoryGroup,categoryGroupCode:e==null?void 0:e[0].categoryGroupCode,truckColorCode:e==null?void 0:e[0].truckColorCode,plateType:e==null?void 0:e[0].plateType,chassisNo:e==null?void 0:e[0].chassisNo},driver:{DRIVER_NAME:t==null?void 0:t[0].nameAr,LICENSE_NUMBER:t==null?void 0:t[0].licenseNo,residentCountry:t==null?void 0:t[0].residentCountry}}])),console.log("findTrucks",e,t))};
