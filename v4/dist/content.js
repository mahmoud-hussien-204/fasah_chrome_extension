let b,m={gettenSchedule:!1};const p={baseUrl:"https://tms.tabadul.sa/api/appointment/tas/v2/",fleetBaseUrl:"https://tms.tabadul.sa/api/fleet/v2/"};chrome.runtime.onMessage.addListener((o,a,r)=>{var n;switch(b=((n=document.cookie.split("; ").find(t=>t.startsWith("fsession=")))==null?void 0:n.split("=")[1])||"",o.action){case"start":{f(o.data),r({status:"success",message:"start",data:{message:""}});break}}return!0});function f(o){const a=new MutationObserver(r=>{r.forEach(n=>{if(!m.gettenSchedule&&n.type==="childList"&&n.addedNodes.length>0){const t=n.addedNodes[0];if(t.nodeType===Node.ELEMENT_NODE){const e=t;if(e.classList.contains("bootstrap-datetimepicker-widget")){const c=e.querySelector(".datepicker-days");if(c){const s=c.querySelector("td:not(.disabled)");s&&(setTimeout(()=>{s.click(),a.disconnect(),m.gettenSchedule=!0},100),setTimeout(()=>{const l=document.querySelectorAll("table > tbody > tr input[type=radio]").length>3?document.querySelector("table > tbody > tr:has(input[type=radio]):nth-last-child(3) input[type=radio]"):document.querySelector("table > tbody > tr:has(input[type=radio]):last-child input[type=radio]");if(!l)return;l.checked=!0,l.dispatchEvent(new Event("change")),l.dispatchEvent(new Event("click"));const d=document.querySelector("button[data-i18n=nextButtonText]");d&&(d.click(),S(o))},200))}}}}})});a.observe(document.getElementById("finalSchedule"),{childList:!0})}const y=async(o,a={},r=p.baseUrl)=>{const n={"Accept-Language":"ar",Accept:"application/json",token:decodeURIComponent(b)};return await(await fetch(`${r+o}`,{method:"GET",...a,headers:{...n,...a==null?void 0:a.headers}})).json()},g=()=>new Date(Date.now()+864e5).toLocaleDateString("en-CA").replace(/-/g,"/"),S=async o=>{var u,h;console.log("apiGetInfo",o);const a=new URLSearchParams({finalDestination:"95",finalDestinationTime:g(),q:o.truckNumber}),r=await y(`truck/verified/all/forAdd?${a.toString()}`,void 0,p.fleetBaseUrl),n=new URLSearchParams({finalDestination:"95",finalDestinationTime:g(),q:o.name}),t=await y(`driver/verified/all/forAdd?${n.toString()}`,void 0,p.fleetBaseUrl);if(!((u=r==null?void 0:r.content)!=null&&u[0]))throw new Error("يوجد خطأ فى معلومات الشاحنة");if(!((h=t==null?void 0:t.content)!=null&&h[0]))throw new Error("يوجد خطأ فى معلومات السائق");const e=r.content.filter(i=>i.plateNumberAr.trim()===o.truckNumber.trim()),c=t.content.filter(i=>i.nameAr.trim().startsWith(o.name.trim())),s=document.querySelector(".pledge-check input");if(!s)return;s.checked=!0,s.dispatchEvent(new Event("change")),s.dispatchEvent(new Event("click"));const l=document.querySelector("#mutliAdded hr + div button");l&&l.click();const d=document.getElementById("entry");if(d){d.setAttribute("records",JSON.stringify([{truck:{plate_number:e==null?void 0:e[0].plateNumberAr,plateCountry:e==null?void 0:e[0].plateCountry,vehicleSequenceNumber:e==null?void 0:e[0].vehicleSequenceNumber,consignmentNumber:"",truckCategoryGroup:e==null?void 0:e[0].truckCategoryGroup,categoryGroupCode:e==null?void 0:e[0].categoryGroupCode,truckColorCode:e==null?void 0:e[0].truckColorCode,plateType:e==null?void 0:e[0].plateType,chassisNo:e==null?void 0:e[0].chassisNo},driver:{DRIVER_NAME:c==null?void 0:c[0].nameAr,LICENSE_NUMBER:c==null?void 0:c[0].licenseNo,residentCountry:c==null?void 0:c[0].residentCountry}}]));const i=document.querySelector(".pledge-check input");if(!i)return;i.checked=!0,i.dispatchEvent(new Event("change")),i.dispatchEvent(new Event("click")),document.querySelector("div.wizard-action-buttons button[data-i18n=submitButtonText]").click()}};(function(){const o=window.fetch;window.fetch=async function(n,t){if(n==="https://tms.tabadul.sa/api/appointment/tas/v2/appointment/transit/create"&&(console.log("Intercepted fetch:",t),t.method==="POST"&&t.body)){let e=JSON.parse(t.body);e.fleet_info=[{truck_id:"TRUCK123",driver_name:"John Doe",license_plate:"ABC123"}],t.body=JSON.stringify(e),console.log("Modified body:",t.body)}return o.apply(this,arguments)};const a=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,t){this._url=t,a.apply(this,arguments)};const r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(n){if(this._url==="https://tms.tabadul.sa/api/appointment/tas/v2/appointment/transit/create"&&(console.log("Intercepted XHR body:",n),n)){let t=JSON.parse(n);t.fleet_info=[{truck_id:"TRUCK123",driver_name:"John Doe",license_plate:"ABC123"}],n=JSON.stringify(t),console.log("Modified XHR body:",n)}r.call(this,n)}})();
